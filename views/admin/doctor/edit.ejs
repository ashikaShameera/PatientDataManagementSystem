<%- include('../partials/head') %>

  <body>
    <main class="admin-panel">
      <%- include('../partials/sidebar') %>
        </div>
        <div class="content">
          <div class="row">
            <div class="col-11">
              <h1>Welcome, Admin!</h1>
              <p>This is the admin panel for the patient management system.</p>
            </div>
            <div class="col-1">
              <button type="button" class="btn btn-danger logoutB" href="#">LogOut</button>
            </div>
          </div>
          <div class="block" style="height: 90%;">
            <div id="content">
              <h1 class="text-center">Update Details Of Doctor <%= doctor.firstName %>
              </h1>


              <form action="/admin/doctor/<%= doctor.id%>?_method=PUT" method="POST" novalidate class="validated-form">
                <div class="d-flex justify-content-around">
                  <div class="col-5">
                    <div class="mb-3">
                      <label for="firstName" class="form-label">First Name:</label>
                      <input type="text" id="firstName" class="form-control" name="doctor[firstName]"
                        value="<%= doctor.firstName %>" required>
                      <div class="valid-feedback">
                        Looks Good!
                      </div>
                    </div>

                    <div class="mb-3">
                      <label for="lastName" class="form-label">Last Name:</label>
                      <input type="text" id="lastName" class="form-control" name="doctor[lastName]"
                        value="<%= doctor.lastName %>" required>
                      <div class="valid-feedback">
                        Looks Good!
                      </div>
                    </div>

                    <div class="mb-3">
                      <label for="nic" class="form-label">NIC:</label>
                      <input type="text" id="nic" name="doctor[nic]" class="form-control" value="<%= doctor.nic %>"
                        required>
                      <div class="valid-feedback">
                        Looks Good!
                      </div>
                    </div>

                    <div class="mb-3">
                      <label for="dateOfBirth" class="form-label">Date of Birth:</label>
                      <input type="text" id="dateOfBirth" name="doctor[dateOfBirth]" value="<%= doctor.dateOfBirth %>"
                        class="form-control" required>
                      <div class="valid-feedback">
                        Looks Good!
                      </div>
                    </div>
                    <div class="md-3">
                      <label for="gender" class="form-label">Gender:</label>
                      <select id="gender" name="doctor[gender]" class="form-control" required>
                        <option value="Male" <% if (doctor.gender === 'Male') { %> selected <% } %>>Male</option>
                        <option value="Female" <% if (doctor.gender === 'Female') { %> selected <% } %>>Female</option>
                        <option value="Other" <% if (doctor.gender === 'Other') { %> selected <% } %>>Other</option>
                      </select>
                      <div class="valid-feedback">
                        Looks Good!
                      </div>
                    </div>
                    <div class="md-3">
                      <label for="contactNumber" class="form-label">Contact Number:</label>
                      <input type="text" id="contactNumber" name="doctor[contactNumber]" value="<%=doctor.contactNumber%>" required class="form-control">
                      <div class="valid-feedback">
                        Looks Good!
                      </div>
                    </div>
                    <div class="mb-3">
                      <label for="email" class="form-label">Email:</label>
                      <input type="email" id="email" name="doctor[email]" class="form-control"  value="<%=doctor.email%>" required>
                      <div class="valid-feedback">
                        Looks Good!
                      </div>
                    </div>
                    <div class="mb-3">
                      <label for="address" class="form-label">Number of Address:</label>
                      <input type="number" id="number" name="doctor[address][number]"  value="<%=doctor.address.number%>" class="form-control">
                      <div class="valid-feedback">
                        Looks Good!
                      </div>
                    </div>
                    <div class="mb-3">
                      <button type="button" id="deleteBtn" class="btn btn-danger form-control">Delete Doctor</button>
                    </div>
                  </div>

                  <div class="col-5">
                    <div class="mb-3">
                      <label for="street" class="form-label">Street:</label>
                      <input type="text" id="street" name="doctor[address][street]" class="form-control" value="<%=doctor.address.street%>">
                      <div class="valid-feedback">
                        Looks Good!
                      </div>
                    </div>
                    <div class="mb-3">
                      <label for="city" class="form-label">City:</label>
                      <input type="text" id="city" name="doctor[address][city]" class="form-control" value="<%=doctor.address.city%>" >
                      <div class="valid-feedback">
                        Looks Good!
                      </div>
                    </div>
                    <div class="mb-3">
                      <label for="state" class="form-label">State:</label>
                      <input type="text" id="state" name="doctor[address][state]" class="form-control" value="<%=doctor.address.state%>" >
                      <div class="valid-feedback">
                        Looks Good!
                      </div>
                    </div>
                    <div class="mb-3">
                      <label for="postalCode" class="form-label">Postal Code:</label>
                      <input type="number" id="postalCode" name="doctor[address][postalCode]" class="form-control" value="<%=doctor.address.postalCode%>" >
                      <div class="valid-feedback">
                        Looks Good!
                      </div>
                    </div>
                    <div class="mb-3">
                      <label for="medicalLicenseNumber" class="form-label">Medical License Number:</label>
                      <input type="text" id="medicalLicenseNumber" name="doctor[medicalLicenseNumber]"
                        class="form-control" required value="<%=doctor.medicalLicenseNumber%>" >
                        <div class="valid-feedback">
                          Looks Good!
                        </div>
                    </div>
                    <div class="mb-3">
                      <label for="specialization" class="form-label">Specialization:</label>
                      <select id="specialization" name="doctor[specialization]" class="form-control" required>
                        <option value="Internal Medicine" <% if (doctor.specialization === 'Internal Medicine') { %> selected <% } %>>Internal Medicine</option>
                        <option value="Family Medicine" <% if (doctor.specialization === 'Family Medicine') { %> selected <% } %>>Family Medicine</option>
                        <option value="Pediatrics" <% if (doctor.specialization === 'Pediatrics') { %> selected <% } %>>Pediatrics</option>
                        <option value="Obstetrics and Gynecology" <% if (doctor.specialization === 'Obstetrics and Gynecology') { %> selected <% } %>>Obstetrics and Gynecology</option>
                        <option value="General Surgery" <% if (doctor.specialization === 'General Surgery') { %> selected <% } %>>General Surgery</option>
                        <option value="Anesthesiology" <% if (doctor.specialization === 'Anesthesiology') { %> selected <% } %>>Anesthesiology</option>
                        <option value="Psychiatry" <% if (doctor.specialization === 'Psychiatry') { %> selected <% } %>>Psychiatry</option>
                        <option value="Orthopedic Surgery" <% if (doctor.specialization === 'Orthopedic Surgery') { %> selected <% } %>>Orthopedic Surgery</option>
                        <option value="Cardiology" <% if (doctor.specialization === 'Cardiology') { %> selected <% } %>>Cardiology</option>
                        <option value="Dermatology" <% if (doctor.specialization === 'Dermatology') { %> selected <% } %>>Dermatology</option>
                      </select>
                    </div>
                    
                    <div class="mb-3">
                      <label for="degree" class="form-label">Degree:</label>
                      <input type="text" id="degree" name="doctor[degree]" class="form-control" required value="<%=doctor.degree%>" >  
                      <div class="valid-feedback">
                        Looks Good!
                      </div>
                    </div>
                    <div class="mb-3">
                      <label for="university" class="form-label">University:</label>
                      <input type="text" id="university" name="doctor[university]" class="form-control" required value="<%=doctor.university%>" > 
                      <div class="valid-feedback">
                        Looks Good!
                      </div> 
                    </div>

                    <div class="mb-3">
                      <button type="submit" class="btn btn-primary form-control">Update Doctor Details</button>
                    </div>
                  </div>
                </div>

              </form>
            </div>
          </div>
        </div>
    </main>
    <script>
      
      document.addEventListener('DOMContentLoaded', function () {
  const deleteBtn = document.getElementById('deleteBtn');

  if (deleteBtn) {
    deleteBtn.addEventListener('click', function () {
      // Confirm with the user if they really want to delete the nurse
      const confirmDelete = confirm('Are you sure you want to delete this doctor?');

      if (confirmDelete) {
        // If the user confirms, make an AJAX request to delete the nurse
        const doctorID = '<%= doctor.id %>'; // You need to set this data attribute on the delete button
       fetch(`/admin/doctor/${doctorID}`, {
          method: 'DELETE',
        })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              // Nurse deleted successfully, redirect or show a success message
              window.location.href = '/admin/doctor'; // Redirect to the nurse list page
            } else {
              console.error(error)
              alert('Failed to delete doctor. Please try again later.');
            }
          })
          .catch(error => {
            console.error('Error deleting doctor:', error);
            alert('An error occurred while deleting the doctor.');
          });
      }
    });
  }
});

      var toggleBtn = document.getElementById('toggleBtn');
      var content = document.getElementById('content');

      var overviewToggleBtn = document.getElementById('overviewToggleBtn');
      var Overview = document.getElementById('overview');

      toggleBtn.addEventListener('click', function () {
        if (content.classList.contains('hidden')) {
          Overview.classList.add('hidden');
          content.classList.remove('hidden');
        } else {
          content.classList.add('hidden');
        }
      });

      overviewToggleBtn.addEventListener('click', function () {
        if (Overview.classList.contains('hidden')) {
          content.classList.add('hidden');
          Overview.classList.remove('hidden');
        } else {
          Overview.classList.add('hidden');
        }
      });


    </script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
      integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
      crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
      integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
      crossorigin="anonymous"></script>
    <script src="/javascripts/boostrapFormValidation.js"></script>
    <script src="/javascripts/admin/admin.js"></script>
  </body>

  </html>