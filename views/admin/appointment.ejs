<%- include('./partials/head') %>

  <body>
    <main class="admin-panel">
      <%- include('./partials/sidebar') %>
        </div>
        <div class="content">
          <div class="row">
            <div class="col-11">
              <h1>Welcome, Admin!</h1>
              <p>This is the admin panel for the patient management system.</p>
            </div>
            <div class="col-1">
              <button type="button" class="btn btn-danger logoutB" href="#">LogOut</button>
            </div>
          </div>
          <div class="row">
            <div class="col-3">
              <button id="overviewToggleBtn" type="button" class="btn btn-primary">ALL Appointment</button>
            </div>
            <div class="col-3">
              <button id="toggleBtn" type="button" class="btn btn-primary">Create Appointment</button>
            </div>
          </div>
          <div class="block">
            <div id="Registation" class="hidden">
              <span>
                <a href="/admin/appointment/Create" class="btn btn-primary">Make Appointment</a>
              </span>
            </div>

            <!-- all appointment -->
            <div id="overview" class="">

              <section>
                <h1>Appointment Details</h1>
                <% if(appointments && appointments.length){ %>
                  <% for(let appointment of appointments) { %>
                    <div>
                      <span>
                        Doctor's First Name : <%= appointment.doctor && appointment.doctor.firstName %>
                      </span>
                      <span>
                        Appointment Date : <%= appointment.date %>
                      </span>
                      <span>
                        Appointment Time : <%= appointment.time %>
                      </span>
                      <span>
                        Room Number : <%= appointment.roomNumber %>
                      </span>
                      <span>
                        Maximum Patients : <%= appointment.maximumPatients %>
                      </span>
                      <span>
                        Current Patients : <%= appointment.currentPatients %>
                      </span>


                      <span>
                        <a href="/admin/appointment/<%=appointment._id%>" class="btn btn-primary">Edit</a>
                      </span>
                      <span>
                        <a href="/admin/appointment/<%= appointment._id %>" class="btn btn-danger"
                          data-action="delete">Delete</a>
                      </span>

                    </div>
                    <br>
                    <% } %>
                      <% } %>
              </section>
            </div>
          </div>
        </div>
        </div>
        
    </main>

    <script src="/public/show.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
      integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
      crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
      integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
      crossorigin="anonymous"></script>



    <script>
      const deleteButtons = document.querySelectorAll('[data-action="delete"]');

      deleteButtons.forEach((button) => {
        button.addEventListener('click', async (event) => {
          event.preventDefault();
          const appointmentId = button.getAttribute('href').split('/').pop();

          const confirmation = confirm('Are you sure you want to delete this appointment?');

          if (confirmation) {
            try {
              const response = await fetch(`/admin/appointment/${appointmentId}`, {
                method: 'DELETE',
              });

              if (response.ok) {
                // Handle success (e.g., remove the appointment from the UI)
                button.parentElement.parentElement.remove();
              } else {
                // Handle error (e.g., display an error message)
                console.error('Failed to delete appointment');
              }
            } catch (error) {
              console.error(error);
            }
          }
        });
      });
    </script>



    <script>

      var toggleBtn = document.getElementById('toggleBtn');
      var content = document.getElementById('Registation');

      var overviewToggleBtn = document.getElementById('overviewToggleBtn');
      var Overview = document.getElementById('overview');

      toggleBtn.addEventListener('click', function () {
        if (content.classList.contains('hidden')) {
          Overview.classList.add('hidden');
          content.classList.remove('hidden');
        } else {
          content.classList.add('hidden');
        }
      });

      overviewToggleBtn.addEventListener('click', function () {
        if (Overview.classList.contains('hidden')) {
          content.classList.add('hidden');
          Overview.classList.remove('hidden');
        } else {
          Overview.classList.add('hidden');
        }
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
      integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
      crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
      integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
      crossorigin="anonymous"></script>
    <script src="/javascripts/boostrapFormValidation.js"></script>
    <script src="/javascripts/admin/admin.js"></script>
    <script>
      // Get the current date
      const currentDate = new Date();

      // Set the date for the next day
      currentDate.setDate(currentDate.getDate() + 1);

      // Format the next day as 'YYYY-MM-DD' for setting the minimum date
      const nextDay = currentDate.toISOString().split("T")[0];

      // Set the minimum date for the appointment date input
      document.getElementById("date").min = nextDay;
    </script>
  </body>

  </html>