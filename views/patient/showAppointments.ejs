<h1>Doctor details <%= doctor.firstName %> </h1>

<section>
    <div style="text-align: center;" class="mt-n4" >
      <h1>Appointments</h1>
      <br><br>
      <% if (appointments && appointments.length) { %>
        <table class="table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Time</th>
              <th>Room Number</th>
              <th>Number of Patients</th>
              <th>Maximum Number of Patients</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <% for (let appointment of appointments) { %>
              <tr class="table-row-style">
                <td>
                  <%= appointment.date %>
                </td>
                <td>
                  <%= appointment.time %>
                </td>
                <td>
                  <%= appointment.roomNumber %>
                </td>
                <td>
                  <%= appointment.currentPatients%>
                </td>
                <td>
                  <%= appointment.maximumPatients %>
                </td>
                <td>
                    <!-- //To Post /:id/:doctorId/appointments -->
                    <form id="appointmentForm" action="/patient/<%= patient._id %>/<%= doctor._id %>/appointments" method="post">
                        <input type="text" value="<%= appointment.id %>"  name="appointmentId" hidden >
                    </form>
                    <button onclick="paymentGateway()">Make the apponitment</button>
                </td>
              </tr>
              <% } %>
          </tbody>
        </table>
        <% } else { %>
          <p>No Appointments</p>
          <% } %>
        </div>
    </section>

    <script src="https://www.payhere.lk/lib/payhere.js"></script>
    <script>
      function paymentGateway() {
  // Payment configuration
  var paymentConfig = {
        "sandbox": true,
        "merchant_id": "1224383",    // Replace your Merchant ID
        "return_url": "#",     // Important
        "cancel_url": "#",     // Important
        "notify_url": "#",
        "order_id": "***",
        "items": "Appoinment with Dr. <%= doctor.firstName %>",
        "amount": "1000",
        "currency": "LKR",
        "hash": "<%= paymentHash %>", // *Replace with generated hash retrieved from backend
        "first_name": "<%= patient.firstName %>",
        "last_name": "<%= patient.lastName %>",
        "email": "<%= patient.email %>",
        "phone": "<%= patient.contactNumber %>",
        "address": "<%= patient.address %>",
        "city": "<%= patient.address.city %>",
        "country": "Sri Lanka"
  };

  // Initialize PayHere
  payhere.onCompleted = function onCompleted() {
    document.getElementById("appointmentForm").submit();
  };

  payhere.onDismissed = function onDismissed() {
    // Note: Prompt the user to pay again or show an error page
    console.log("Payment dismissed");
  };

  payhere.onError = function onError(error) {
    // Note: Show an error page
    console.log("Error:" + error);
  };

  // Open the PayHere payment modal
  payhere.startPayment(paymentConfig);
}

    </script>

